# Firestore ë³´ì•ˆ ê·œì¹™ ì„¤ì • ê°€ì´ë“œ

## ğŸ”´ í˜„ì¬ ì˜¤ë¥˜
```
FirebaseError: Missing or insufficient permissions
```

ì´ ì˜¤ë¥˜ëŠ” Firestore ë³´ì•ˆ ê·œì¹™ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì˜ëª» ì„¤ì •ë˜ì—ˆì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤.

## âœ… í•´ê²° ë°©ë²•

### 1. Firebase Console ì ‘ì†
1. [Firebase Console](https://console.firebase.google.com/) ì ‘ì†
2. í”„ë¡œì íŠ¸ **d2tamarefact** ì„ íƒ
3. ì™¼ìª½ ë©”ë‰´ì—ì„œ **Firestore Database** í´ë¦­
4. **Rules** íƒ­ í´ë¦­

### 2. ë³´ì•ˆ ê·œì¹™ ì„¤ì •

í˜„ì¬ ê·œì¹™ì„ ë‹¤ìŒìœ¼ë¡œ êµì²´:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // users ì»¬ë ‰ì…˜
    match /users/{userId} {
      // ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ìì‹ ì˜ ë°ì´í„°ì— ì ‘ê·¼
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // ì„œë¸Œì»¬ë ‰ì…˜: slots
      match /slots/{slotId} {
        // ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ìì‹ ì˜ ìŠ¬ë¡¯ì— ì ‘ê·¼
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // metadata ì»¬ë ‰ì…˜ (í…Œì´ë¨¸ëª… ì¤‘ë³µ ê²€ì‚¬ìš©)
    match /metadata/nicknames {
      // ëª¨ë“  ì¸ì¦ëœ ì‚¬ìš©ìê°€ ì½ê¸° ê°€ëŠ¥ (ì¤‘ë³µ ê²€ì‚¬ìš©)
      // ì“°ê¸°ëŠ” ì„œë²„ì—ì„œë§Œ ì²˜ë¦¬í•˜ê±°ë‚˜, ì‚¬ìš©ìê°€ ìì‹ ì˜ ë‹‰ë„¤ì„ë§Œ ì¶”ê°€/ì œê±° ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ
      allow read: if request.auth != null;
      allow write: if request.auth != null; // ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œë§Œ ì“°ëŠ” ê²ƒì´ ì•ˆì „í•˜ì§€ë§Œ, ê°œë°œ í¸ì˜ë¥¼ ìœ„í•´ í—ˆìš©
    }
  }
}
```

### 3. ê·œì¹™ ê²Œì‹œ
1. **ê²Œì‹œ** ë²„íŠ¼ í´ë¦­
2. í™•ì¸ ëŒ€í™”ìƒìì—ì„œ **ê²Œì‹œ** í´ë¦­
3. ëª‡ ì´ˆ í›„ ê·œì¹™ì´ ì ìš©ë©ë‹ˆë‹¤

## ğŸ§ª ê°œë°œìš© ì„ì‹œ ê·œì¹™ (í…ŒìŠ¤íŠ¸ ì „ìš©)

âš ï¸ **ì£¼ì˜**: ì´ ê·œì¹™ì€ ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©ì…ë‹ˆë‹¤. í”„ë¡œë•ì…˜ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”!

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;  // ëª¨ë“  ì ‘ê·¼ í—ˆìš© (ê°œë°œìš©)
    }
  }
}
```

## âœ… ê·œì¹™ ì ìš© í™•ì¸

1. ë¸Œë¼ìš°ì €ì—ì„œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (F5)
2. "ìƒˆ ë‹¤ë§ˆê³ ì¹˜ ì‹œì‘" ë²„íŠ¼ ë‹¤ì‹œ í´ë¦­
3. ì½˜ì†”ì—ì„œ ì—ëŸ¬ê°€ ì‚¬ë¼ì¡ŒëŠ”ì§€ í™•ì¸

## ğŸ“‹ ê·œì¹™ ì„¤ëª…

### ê¸°ë³¸ êµ¬ì¡°
- `users/{userId}`: ê° ìœ ì €ì˜ ë¬¸ì„œ (tamerName í¬í•¨)
- `users/{userId}/slots/{slotId}`: ê° ìœ ì €ì˜ ìŠ¬ë¡¯ ì„œë¸Œì»¬ë ‰ì…˜
- `metadata/nicknames`: ì‚¬ìš© ì¤‘ì¸ í…Œì´ë¨¸ëª… ëª©ë¡ (ì¤‘ë³µ ê²€ì‚¬ìš©)

### ì ‘ê·¼ ì¡°ê±´
- `request.auth != null`: ë¡œê·¸ì¸ëœ ì‚¬ìš©ìë§Œ
- `request.auth.uid == userId`: ìì‹ ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼ ê°€ëŠ¥

### ë³´ì•ˆ
- ë‹¤ë¥¸ ìœ ì €ì˜ ë°ì´í„°ì— ì ‘ê·¼ ë¶ˆê°€
- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ì ‘ê·¼ ë¶ˆê°€

## ğŸ› ì—¬ì „íˆ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

1. **ê·œì¹™ì´ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸**
   - Firebase Consoleì—ì„œ Rules íƒ­ í™•ì¸
   - "ê²Œì‹œë¨" ìƒíƒœì¸ì§€ í™•ì¸

2. **ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸**
   - ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ `localStorage` í™•ì¸
   - ë˜ëŠ” SelectScreenì—ì„œ í”„ë¡œí•„ ì‚¬ì§„ì´ ë³´ì´ëŠ”ì§€ í™•ì¸

3. **ìºì‹œ í´ë¦¬ì–´**
   - ë¸Œë¼ìš°ì € í•˜ë“œ ë¦¬í”„ë ˆì‹œ (Ctrl+Shift+R ë˜ëŠ” Cmd+Shift+R)

4. **ì„œë²„ ì¬ì‹œì‘**
   ```bash
   # ì„œë²„ ì¤‘ì§€ í›„
   npm start
   ```







